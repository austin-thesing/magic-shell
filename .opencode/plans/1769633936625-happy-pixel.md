# Plan: Sync Models with Zen API & Fix Endpoint Routing

## Summary

1. **Sync hardcoded models** with current Zen API (add missing, remove deprecated)
2. **Use correct endpoints** per model type as specified in docs
3. **Move Gemini 2.5 to OpenRouter only** (not available on Zen)

---

## Research Findings

### Current Zen API Models (from `/zen/v1/models`)
```
claude-opus-4-5, claude-opus-4-1, claude-sonnet-4, claude-sonnet-4-5, claude-3-5-haiku, claude-haiku-4-5
gemini-3-pro, gemini-3-flash
gpt-5.2, gpt-5.2-codex, gpt-5.1, gpt-5.1-codex-max, gpt-5.1-codex, gpt-5.1-codex-mini, gpt-5, gpt-5-codex, gpt-5-nano
qwen3-coder, glm-4.7, glm-4.6, minimax-m2.1, kimi-k2.5, kimi-k2, kimi-k2-thinking, big-pickle
```

### Changes Needed
| Action | Models |
|--------|--------|
| **Add to Zen** | `minimax-m2.1`, `kimi-k2.5` |
| **Remove from Zen** | `grok-code` (not in API) |
| **Move to OpenRouter** | `gemini-2.5-pro`, `gemini-2.5-flash` (not in Zen API) |

### Correct Endpoints (from docs)
| Model Pattern | Endpoint | AI SDK Package |
|---------------|----------|----------------|
| `gpt-*` | `/zen/v1/responses` | `@ai-sdk/openai` |
| `claude-*` | `/zen/v1/messages` | `@ai-sdk/anthropic` |
| `gemini-*` | `/zen/v1/models/{model-id}` | `@ai-sdk/google` |
| Others | `/zen/v1/chat/completions` | `@ai-sdk/openai-compatible` |

### Current Code Issues
1. Using single `ZEN_BASE_URL` for all - but Gemini needs `/models/{model-id}`
2. Models out of sync with API

---

## Implementation Plan

### 1. Fix API Endpoints (`src/lib/api.ts`)

**Update endpoint URLs per model type:**

```typescript
// Base URLs per API type
const ZEN_ENDPOINTS = {
  responses: "https://opencode.ai/zen/v1",      // GPT models use /responses
  messages: "https://opencode.ai/zen/v1",       // Claude models use /messages  
  google: "https://opencode.ai/zen/v1/models",  // Gemini: /models/{model-id}
  chat: "https://opencode.ai/zen/v1",           // Others use /chat/completions
}
```

**Update `callZenGoogle()` to use model-specific URL:**
```typescript
const google = createGoogleGenerativeAI({
  apiKey,
  baseURL: `https://opencode.ai/zen/v1/models/${modelId}`,
})
```

### 2. Update Hardcoded Models (`src/lib/types.ts`)

**OPENCODE_ZEN_MODELS - Add:**
```typescript
{
  id: "minimax-m2.1",
  name: "MiniMax M2.1", 
  description: "MiniMax's capable model",
  category: "smart",
  provider: "opencode-zen",
  contextLength: 128000,
},
{
  id: "kimi-k2.5",
  name: "Kimi K2.5",
  description: "Moonshot's latest model", 
  category: "smart",
  provider: "opencode-zen",
  contextLength: 131072,
},
```

**OPENCODE_ZEN_MODELS - Remove:**
- `grok-code` (not in Zen API)
- `gemini-2.5-pro` (move to OpenRouter)
- `gemini-2.5-flash` (move to OpenRouter)

**OPENROUTER_MODELS - Add Gemini 2.5:**
```typescript
{
  id: "google/gemini-2.5-pro",
  name: "Gemini 2.5 Pro",
  description: "Google's Gemini 2.5 Pro (stable until June 2026)",
  category: "smart",
  provider: "openrouter",
  contextLength: 1000000,
},
{
  id: "google/gemini-2.5-flash", 
  name: "Gemini 2.5 Flash",
  description: "Google's fast Gemini 2.5 (stable until June 2026)",
  category: "fast",
  provider: "openrouter",
  contextLength: 1000000,
},
```

---

## Files to Modify

| File | Changes |
|------|---------|
| `src/lib/api.ts` | Fix Gemini endpoint URL |
| `src/lib/types.ts` | Add minimax/kimi-k2.5, remove grok-code, move Gemini 2.5 to OpenRouter |

---

## Verification

1. **Test endpoint routing:**
   ```bash
   DEBUG_API=1 msh --model claude-sonnet-4 "hello"   # Should use /messages
   DEBUG_API=1 msh --model gpt-5.2 "hello"           # Should use /responses  
   DEBUG_API=1 msh --model gemini-3-flash "hello"    # Should use /models/gemini-3-flash
   DEBUG_API=1 msh --model big-pickle "hello"        # Should use /chat/completions
   ```

2. **Test new models work:**
   ```bash
   msh --model minimax-m2.1 "list files"
   msh --model kimi-k2.5 "show disk usage"
   ```

3. **Test Gemini 2.5 via OpenRouter:**
   ```bash
   msh --provider openrouter
   msh --model google/gemini-2.5-flash "hello"
   ```

4. **Type checking:**
   ```bash
   bun run typecheck
   ```
