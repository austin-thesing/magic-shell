---
title: Configuration
description: Set up your API key and customize Magic Shell settings.
---

import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

## API Key Setup

Magic Shell requires an API key from one of the supported providers. Run the setup wizard:

```bash
msh --setup
```

This will guide you through:
1. Selecting a provider (OpenCode Zen, OpenRouter, or custom models)
2. Entering your API key (if needed)
3. Choosing a default model

### Get an API Key

<Tabs>
  <TabItem label="OpenCode Zen (Recommended)">
    OpenCode Zen offers curated models optimized for coding, including **free models**.

    1. Visit [opencode.ai/auth](https://opencode.ai/auth)
    2. Create an account or sign in
    3. Copy your API key

    <Aside type="tip">
      OpenCode Zen has models like `glm-4.7` that work great for most tasks!
    </Aside>
  </TabItem>
  <TabItem label="OpenRouter">
    OpenRouter provides access to a wide variety of models from different providers.

    1. Visit [openrouter.ai/keys](https://openrouter.ai/keys)
    2. Create an account or sign in
    3. Generate a new API key
  </TabItem>
</Tabs>

### Environment Variables

You can also set your API key via environment variables:

```bash
# OpenCode Zen
export OPENCODE_ZEN_API_KEY="your-key-here"

# OpenRouter
export OPENROUTER_API_KEY="your-key-here"
```

Add these to your shell profile (`~/.bashrc`, `~/.zshrc`, etc.) for persistence.

## Custom Models

Magic Shell supports custom models for local or remote OpenAI-compatible endpoints. This is perfect for running models locally with LM Studio or Ollama.

### Adding a Custom Model

```bash
# Interactive setup wizard
msh --add-model
```

The wizard will prompt you for:
- Model ID (unique identifier)
- Display name
- API model ID (sent to the server)
- Base URL (e.g., `http://localhost:1234/v1`)
- API key (optional, stored securely)
- Category (fast/smart/reasoning)

### Managing Custom Models

```bash
# List all custom models
msh --list-custom

# Set a custom model as default
msh --model my-local-llama

# Remove a custom model
msh --remove-model my-local-llama
```

Custom model API keys are stored securely in your system keychain, just like provider API keys.

## Configuration File

Magic Shell stores configuration in `~/.magic-shell/config.json`:

```json
{
  "provider": "opencode-zen",
  "defaultModel": "big-pickle",
  "safetyLevel": "moderate",
  "dryRunByDefault": false,
  "theme": "opencode"
}
```

### Options

| Option | Description | Default |
|--------|-------------|---------|
| `provider` | AI provider (`opencode-zen`, `openrouter`, or `custom`) | `opencode-zen` |
| `defaultModel` | Default model ID | `big-pickle` |
| `safetyLevel` | Safety strictness (`strict`, `moderate`, `relaxed`) | `moderate` |
| `dryRunByDefault` | Always show commands without executing | `false` |
| `theme` | Color theme name | `opencode` |

## Secure Key Storage

API keys are stored securely in your system's keychain:

| Platform | Storage Location |
|----------|-----------------|
| macOS | macOS Keychain |
| Linux | libsecret (secret-tool) |
| Windows | Windows Credential Manager |

<Aside>
  Keys stored in the keychain take precedence over environment variables.
</Aside>

## Changing Settings

### Via CLI

```bash
# Change provider
msh --provider openrouter

# Change default model
msh --model claude-3-5-sonnet

# Add a custom model
msh --add-model

# List custom models
msh --list-custom

# Change theme
msh --theme tokyonight

# List available models
msh --models

# List available themes
msh --themes
```

### Via TUI

In TUI mode (`mshell`), use keyboard shortcuts:
- `Ctrl+X M` - Change model
- `Ctrl+X S` - Switch provider
- `Ctrl+X T` - Change theme
- `Ctrl+X C` - View config

## Debug Mode

Enable API response debugging:

```bash
DEBUG_API=1 msh "your query"
```

This shows the full API request and response, useful for troubleshooting.
